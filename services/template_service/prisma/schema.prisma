generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Template Model
model Template {
  id            String   @id @default(uuid()) @db.Uuid
  template_code String    @unique @default("TEMP_CODE")
  name          String   @db.VarChar(200)
  type          TemplateType
  subject       String   @db.Text
  body          String   @db.Text
  variables     Json?    @db.JsonB
  language      String   @default("en") @db.VarChar(10)
  is_active     Boolean  @default(true)
  created_by    String?  @db.VarChar(100)
  updated_by    String?  @db.VarChar(100)
  metadata      Json?    @db.JsonB
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @updatedAt @db.Timestamptz(6)
  
  versions      TemplateVersion[]
  
  @@index([template_code])
  @@index([type])
  @@index([language])
  @@index([is_active])
  
  @@map("templates")
}

// Template Version Model
model TemplateVersion {
  id             String   @id @default(uuid()) @db.Uuid
  template_id    String   @db.Uuid
  template       Template @relation(fields: [template_id], references: [id], onDelete: Cascade)
  version        Int
  subject        String   @db.Text
  body           String   @db.Text
  variables      Json?    @db.JsonB
  changed_by     String?  @db.VarChar(100)
  change_reason  String?  @db.Text
  created_at     DateTime @default(now()) @db.Timestamptz(6)
  
  @@unique([template_id, version])
  @@index([template_id])
  
  @@map("template_versions")
}

enum TemplateType {
  EMAIL
  PUSH
  SMS
}